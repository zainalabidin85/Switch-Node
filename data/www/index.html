<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Relay</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="wrap">
  <div class="card">

    <div class="header">
      <h2>Relay</h2>
      <a href="/settings" class="gear">
        <!-- Gear icon -->
        <svg viewBox="0 0 24 24">
          <path fill="currentColor"
            d="M12 8a4 4 0 1 0 4 4 4 4 0 0 0-4-4zm9.4 4a7.5 7.5 0 0 0-.1-1l2.1-1.6-2-3.5-2.5 1a7.8 7.8 0 0 0-1.7-1l-.4-2.6h-4l-.4 2.6a7.8 7.8 0 0 0-1.7 1l-2.5-1-2 3.5 2.1 1.6a7.5 7.5 0 0 0 0 2l-2.1 1.6 2 3.5 2.5-1a7.8 7.8 0 0 0 1.7 1l.4 2.6h4l.4-2.6a7.8 7.8 0 0 0 1.7-1l2.5 1 2-3.5-2.1-1.6a7.5 7.5 0 0 0 .1-1z"/>
        </svg>
      </a>
    </div>

    <button id="btn" class="big-switch off">OFF</button>

    <div class="pills">
      <span id="pill-ip" class="pill">IP</span>
      <span id="pill-mdns" class="pill">mDNS</span>
      <span id="pill-mqtt" class="pill">MQTT</span>
      <span id="pill-input" class="pill">Input</span>
    </div>

  </div>
</div>

<script>
const btn = document.getElementById('btn');
const pillIp = pill-mdns = null;

async function refresh(){
  const r = await fetch('/api/status');
  const d = await r.json();

  btn.textContent = d.relay ? 'ON' : 'OFF';
  btn.className = 'big-switch ' + (d.relay ? 'on':'off');

  document.getElementById('pill-ip').textContent = d.ip;
  document.getElementById('pill-mdns').textContent = d.mdns;

  const pm = document.getElementById('pill-mqtt');
  pm.textContent = d.mqtt_connected ? 'MQTT ON':'MQTT OFF';
  pm.className = 'pill ' + (d.mqtt_connected?'on':'off');

  const pi = document.getElementById('pill-input');
  pi.textContent = d.input_pressed ? 'Input ON':'Input OFF';
  pi.className = 'pill ' + (d.input_pressed?'on':'off');
}

btn.onclick = async () => {
  const on = btn.classList.contains('off');
  await fetch('/api/relay', {
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:'state='+(on?1:0)
  });
  refresh();
};

refresh();
setInterval(refresh,2000);
</script>
</body>
</html>
